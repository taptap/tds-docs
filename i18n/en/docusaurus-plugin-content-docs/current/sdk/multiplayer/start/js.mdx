---
title: Introduction to Multiplayer Online Battle · JavaScript
sidebar_label: JavaScript
sidebar_position: 1
---

import { Conditional } from "/src/docComponents/conditional";

Welcome to Multiplayer Online Battles. This tutorial will explain the core usage of the SDK by simulating a scene of comparing player scores.

## Install

The multiplayer online battle client SDK is open source, you can directly download the [Release version](https://github.com/leancloud/Play-SDK-JS/releases). Please visit [Play-SDK-JS](https://github.com/leancloud/Play-SDK-JS) for the source code.

## Support development platform

WeChat Developer Tools: WeChat Mini Programs / WeChat Mini Games

CocosCreator: Mac, Web, WeChat Mini Game, Facebook Instant Game, iOS, Android.

LayaAir: WeChat Mini Game

Egret：Web

### Cocos Creator

[Download `play.js`](https://github.com/leancloud/Play-SDK-JS/releases) and drag it into the Cocos Creator project, select the "plugin" mode to import. Please refer to [Cocos Creator Plugin Scripts](https://docs.cocos.com/creator/manual/zh/scripting/external-scripts.html).

Select the play.js file just imported in Cocos Creator, and select all the following options in the "Property Inspector":

- Import as plugin
- Allow web platforms to load
- Allow editor to load
- Allow Native platform to load

as the picture shows:

![image](/img/multiplayer/cocos-creator-multiplayer-install.png)

### LayaAir

[Download `play-laya.js`](https://github.com/leancloud/Play-SDK-JS/releases) to the bin/libs directory of the Laya project.

Introduce the newly downloaded SDK file before the project "UI files generated by IDE" in bin/index.html:

``` diff
   <!--Provides various component implementations for making UI-->
     <script type="text/javascript" src="libs/laya.ui.js"></script>
   <!--User-defined sequence files are added here-->
   <!--jsfile--Custom-->
+ <script src="libs/play-laya.js"></script>
   <!--jsfile--Custom-->
   <!--UI file generated by IDE-->
   <script src="../src/ui/layaUI.max.all.js"></script>
```

### Egret

[Download `play-egret.zip`](https://github.com/leancloud/Play-SDK-JS/releases) and extract it to the libs directory of the Egret project.

Add the SDK configuration to the egretProperties.json file in the egret project:

``` diff
{
   "engineVersion": "5.2.13",
   "compilerVersion": "5.2.13",
   "template": {},
   "target": {
     "current": "web"
   },
   "modules": [
     {
       "name": "egret"
     },
     ...
+ {
+ "name": "Play",
+ "path": "./libs/play"
+ }
   ]
}
```

Under the Egret project, execute the `Egret build -e` command. If the SDK reference is generated in the manifest.json, it means that the SDK is installed successfully.

``` diff
{
   "initial": [
     "libs/modules/egret/egret.js",
     ...
+ "libs/play/Play.js"
   ],
   "game": [
     ...
   ]
}
```

Please refer to [How to use Egret third-party library](https://docs.egret.com/engine/docs/extension/threes/instructions).

### WeChat Mini Program

[Download `play-weapp.js`](https://github.com/leancloud/Play-SDK-JS/releases) and drag it to the project directory of the WeChat applet.

### Node.js Installation

Install and reference the SDK:

```sh
npm install @leancloud/play --save
```

## logs

Logs are convenient for us to track down problems, and the SDK supports opening log debugging in browsers and Node.js environments. After the debug log is enabled, the SDK will output information such as network requests and error messages to the console.

### browser

In the browser environment, please open the console of the browser and run the following command:

```shell
localStorage.debug = 'Play'
```

### Node.js

In the Node.js environment, you need to set the environment variable DEBUG to `Play`, you can set the environment variable before starting a command.
The following uses the `lean up` command to start cloud engine debugging locally as an example:

```sh
# Unix
DEBUG='Play' lean up
# Windows cmd
set DEBUG=Play lean up
```

## Initialization

to import SDK

```javascript
const {
   Client,
   Region,
   Event,
   ReceiverGroup,
   setAdapters,
   LogLevel,
   setLogger,
} = Play;
```

<Conditional brand="leancloud">

```javascript
const client = new Client({
     // set APP ID
     appId: "your-app-id",
     // Set APP Key
     appKey: "your-app-key",
     // Set Server (please replace xxx.example.com with the custom API domain name bound to your application)
     playServer: 'https://xxx.example.com',
     // set user id
     userId: 'tarara',
     // Set the game version number (optional, default 0.0.1)
     gameVersion: '0.0.1'
});
```

</Conditional>

<Conditional brand="tds">

```js
const client = new Client({
   appId: 'your-client-id', // Client ID of the game
   appKey: 'your-client-token', // Client Token of the game
   playServer: 'https://your_server_url', // API domain name of the game
   userId: 'tarara', // set user id
   gameVersion: '0.0.1' // Set the game version number, optional, default 0.0.1, players of different versions will not be matched to the same room
});
```

- In **Developer Center > Your Game > Game Services > Application Configuration**, you can check the game's `Client ID` and `Client Token`.
- Check the API domain name at **Application Configuration > Domain Name Configuration > API**, refer to the documentation about [Domain Name](/sdk/domain/guide/).

</Conditional>

## Connect to multiplayer server

```javascript
client
   .connect()
   .then(() => {
     // connection succeeded
   })
   .catch((error) => {
     // Connection failed
     console.error(error.code, error.detail);
   });
```

## Create or join a room

By default, the Play SDK does not need to join the "lobby" to create/join a specified room.

```javascript
// For example, 4 players join a room named "room1" at the same time, if it does not exist, create and join
client
   .joinOrCreateRoom("room1")
   .then(() => {
     // join or create room successfully
   })
   .catch((error) => {
     // Failed to join the room, and did not successfully create the room
     console.error(error.code, error.detail);
   });
```

`joinOrCreateRoom` ensures that two client players can enter the same room with the same roomName. Please refer to the [Development Guide](/sdk/multiplayer/guide/js/#Join or create a specified room) for more information about the usage of `joinOrCreateRoom`.

## Synchronize player properties through CustomPlayerProperties

When a new player joins the room, the Master assigns a score to each player, and this score is synchronized to the player through the "Player Custom Attribute".
(There is no more complicated algorithm here, just assign 10 points to Master and 5 points to other players).

```javascript
// Register new player join room event
client.on(Event.PLAYER_ROOM_JOINED, (data) => {
   const { newPlayer } = data;
   console.log(`new player: ${newPlayer.userId}`);
   if (client. player. isMaster) {
     // Get the list of players in the room
     const playerList = client. room. playerList;
     for (let i = 0; i < playerList. length; i++) {
       const player = playerList[i];
       // Judging if it is the homeowner, set 10 points, otherwise set 5 points
       if (player. isMaster) {
         player.setCustomProperties({
           point: 10,
         });
       } else {
         player.setCustomProperties({
           point: 5,
         });
       }
     }
     //...
   }
});
```

After the player gets the score, display his score.

```javascript
// Register the "Player Attribute Change" event
client.on(Event.PLAYER_CUSTOM_PROPERTIES_CHANGED, (data) => {
   const { player } = data;
   // Deconstruct to get the player's score
   const { point } = player. customProperties;
   console.log(`${player.userId}: ${point}`);
   if (player. isLocal) {
     // Judge if the player is himself, then do UI display
     this.scoreLabel.string = `score:${point}`;
   }
});
```

## Communication through "custom events"

When the scores are distributed, send the ID of the winner (Master) as a parameter to all players through a custom event.

```javascript
if (client. player. isMaster) {
   const WIN_EVENT_ID = 2;
   client. sendEvent(
     WIN_EVENT_ID,
     { winnerId: client.room.masterId },
     { receiverGroup: ReceiverGroup. All }
   );
}
```

According to whether the winner is himself or not, different UI displays are made.

```javascript
// register custom event
client. on(Event. CUSTOM_EVENT, (event) => {
   // Destructure event parameters
   const { eventId, eventData } = event;
   if (eventId === "win") {
     // Deconstruct to get the winner Id
     const { winnerId } = eventData;
     console.log(`winnerId: ${winnerId}`);
     // If the winner is yourself, display the victory UI; otherwise display the failure UI
     if (client. player. actorId === winnerId) {
       this.resultLabel.string = "win";
     } else {
       this.resultLabel.string = "lose";
     }
     client.close().then(() => {
       // disconnected successfully
     });
   }
});
```

## Demo

We have completed this demo in Cocos Creator, LayaAir, and Egret Wing for everyone to run and refer to.

[QuickStart project](https://github.com/leancloud/Play-Quick-Start-JS).

## Build Notes

You can build the supported projects through Cocos Creator.

Only a little extra configuration is required when building an Android project, and the following code needs to be added before initializing `play`:

```js
onLoad()