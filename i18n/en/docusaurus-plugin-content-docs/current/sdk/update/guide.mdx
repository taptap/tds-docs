---
title: Guide
sidebar_label: Guide
sidebar_position: 2
---

import MultiLang from "/src/docComponents/MultiLang";
import CodeBlock from "@theme/CodeBlock";
import sdkVersions from "/src/docComponents/sdkVersions";
import { Conditional } from "/src/docComponents/conditional";
import AndroidFaq from "../_partials/android-package-visibility.mdx";
import UnitySDKInstallation from "../_partials/unity-sdk-installation.mdx";

:::info
This document only applies to the domestic version, please refer to [Documentation](/tap-update-old-guide/) for the overseas version.
:::
## Environmental Requirements

<MultiLang kind="ue">

<>

- TapSDK **3.23.0** and above
- Unity 2019.4 or higher
- Android 5.0 (API level 21) or higher

<details>

<summary>Click to expand Upgrading Gradle Versions for Unity Prior to 2022.3</summary>

In order to match [Gradle version to Android Gradle Plugin version](https://developer.android.com/studio/releases/gradle-plugin#expandable-1), you need to update the Gradle version, download [ 6.7.1 version of Gradle](https://services.gradle.org/distributions/gradle-6.7.1-bin.zip), unzip it and put it into a custom folder, and **NOT** check `Preferences` -> ` External Tools` -> `Android` -> `Gradle Installed with Unity(recommended)`, instead select the location of the Gradle folder after unzip, e.g. <some path\>/gradle-6.7.1.
In addition, the Unity Update Wake module will **automatically** update the version of the Android Gradle Plugin used in the project, if you need to change it or check it manually, you can do so in `Project Settings` -> `Player` -> `Android Tab` -> `Publish Settings` -> `Build`, and then check the **Custom Base Gradle Template** box.
Apply the following changes to this generated file:
**Assets/Plugins/Android/baseProjectTemplate.gradle**

Modify the contents of the file.

```groovy
dependencies {
    // Change the version to at least 4.2.0.
    classpath 'com.android.tools.build:gradle:4.2.0'
}
```

</details>

</>

<>

- TapSDK **3.23.0** and above
- Android 5.0 (API level 21) or above

</>

<>

- Due to Apple's policy, the TapTap client on iOS platform does not provide game update function.

</>

<>

- Install UE 4.26 and above
- iOS 12 or later
- Android 5.0 (API level 21) or higher
- macOS 10.14.0 or later
- Windows 7 or higher

**Supported platforms**: Android / iOS / Windows / macOS

</>

</MultiLang>


## Pre-integration preparation

To use the update wake function, you need to have uploaded an APK in **TapTap Developer Centre > Store > Game Info > Store Info**, with the release settings set to **Go Live Now** and passed **Audit** (if you don't want to go public for the time being, you can select the release status of **Stay Tuned** or **Reserve**).



## SDK Acquisition

<MultiLang kind="ue">

<>

The SDK can be imported either **through Unity Package Manager** or manually**. Please choose according to your project needs.

#### Method 1: Use Unity Package Manager

##### NPMJS Installation

Starting with version 3.25.0, TapSDK supports NPMJS installations, with the advantage that only the version number needs to be configured and nested dependencies are supported.

Add the following dependencies to the project's `Packages/manifest.json` file:

<CodeBlock className="json">
  {`"dependencies":{
    "com.taptap.tds.update":"${sdkVersions.taptap.unity}",
}`}
</CodeBlock>

Note, however, that `scopedRegistries` should be declared at the `dependencies` level in `Packages/manifest.json`:

<CodeBlock className="json">
{`"scopedRegistries": [
    {
      "name": "NPMJS",
      "url": "https://registry.npmjs.org/",
      "scopes": ["com.tapsdk", "com.taptap", "com.leancloud"]
    }
  ]`}
</CodeBlock>

##### GitHub Installation

Add the following dependencies to the project's `Packages/manifest.json` file:

<CodeBlock className="json">
  {`"dependencies":{
    "com.taptap.tds.common":"https://github.com/TapTap/TapCommon-Unity.git#${sdkVersions.taptap.unity}",
    "com.taptap.tds.update":"https://github.com/TapTap/TapUpdate-Unity.git#${sdkVersions.taptap.unity}",
    "com.leancloud.storage":"https://github.com/leancloud/csharp-sdk-upm.git#storage-${sdkVersions.leancloud.csharp}",
    "com.tapsdk.androiddependencyresolver":"${sdkVersions.taptap.adr}",
}
"scopedRegistries": [
  {
    "name": "TapSDK",
    "url": "https://nexus.tapsvc.com/repository/npm-registry/",
    "scopes": [
      "com.tapsdk",
      "com.taptap",
      "com.leancloud"
      ]
   }
]`}
</CodeBlock>

Select **Window > Package Manager** in the Unity top menu to see the packages already installed in your project.

#### Method 2: Manual import

1. Find the **TapSDK Unity** and **LeanCloud C# SDK** downloads on the [download page](/tap-download) and download `TapSDK-UnityPackage.zip` and `LeanCloud-SDK-Realtime-Unity.zip` respectively.

    Then please [**click to download**](https://github.com/taptap/android_dependency_resolver/releases) `TapTap_AndroidDependencyResolver.unitypackage` 。

2. In the Unity project, go to **Assets > Import Packages > Custom Packages**, and from the extracted `TapSDK-UnityPackage.zip`, select the TapSDK packages that you want to use in the game and import them:

    - TapTap_Common.unitypackage TapSDK Basic library, mandatory.
    - TapTap_Update.unitypackage TapTap Evoke the update library, mandatory.
    - TapTap_AndroidDependencyResolver.unitypackage mandatory.

3. Unzip the `LeanCloud-SDK-Realtime-Unity.zip` into the Plugins folder and drag and drop it into Unity.

</>

<>

Get TapSDK at [download page](/tap-download), add `TapUpdate` and `TapCommon` modules.

<CodeBlock className="groovy">
  {`repositories{  
    flatDir {  
        dirs 'libs'  
    }  
}  
dependencies {  
    ... 
    implementation (name:'TapUpdate_${sdkVersions.taptap.android}', ext:'aar')
    implementation (name:'TapCommon_${sdkVersions.taptap.android}', ext:'aar')
    implementation 'com.squareup.okhttp3:okhttp:3.12.1'
    implementation 'androidx.core:core:1.6.0'
    implementation 'com.google.android.flexbox:flexbox:3.0.0'
}`}

</CodeBlock>

</>
<>

Due to Apple's policy, the TapTap client on iOS platform does not provide game update function.

</>

<>

#### Installation  Plugins

* Download [TapSDK UE4](/tap-download), TapSDK-UE4-xxx.zip Unzip the `TapUpdate`, `TapCommon` folders and copy them to the `Plugins` directory of your project.
* Restart Unreal Editor
* Open Editor > Plugins > Project > TapTap and enable the `TapUpdate` module.


#### Adding Dependencies

Add the required modules to Project.Build.cs.

```cs
PublicDependencyModuleNames.AddRange(new string[] { "Core",
	"CoreUObject",
	"Engine",
	"Json",
	"InputCore",
	"JsonUtilities",
	"SlateCore",
	"TapCommon",
    "TapUpdate",
});
```

#### Importing header files

```cpp
#include "TapUpdate.h"
```

</>

</MultiLang>

## Start Update

:::tip
If TapSDK checks that the TapTap client is not installed on the current device, it will first ask the user if they want to use TapTap to update, and the callback method for cancelling the update will be executed when they click the "Cancel" button.
:::

<MultiLang kind="ue">

```cs
using TapTap.Update

TapTap.Update.TapUpdate.UpdateGame(() => {
  //  Update cancel
});
```

```java
import com.taptap.services.update.TapUpdate;
import com.taptap.services.update.TapUpdateCallback;


TapUpdate.updateGame(DemoUpdateActivity.this, new TapUpdateCallback() {
    @Override
    public void onCancel() {
        //  Update cancel
    }
});
```

Due to Apple's policy, the TapTap client on iOS platform does not provide game update function.

```cpp
FTapUpdate::UpdateGame(FSimpleDelegate::CreateLambda([]() {
  // Update cancel
}));
```

</MultiLang>


## Open the game's comments section

<MultiLang>

<>

<Conditional region="cn">

```cs
// For Mainland China
TapCommon.OpenReviewInTapTap(appId, openSuccess =>
{
    if (openSuccess) {
        Debug.Log("Open the game comment section successfully");
    }
});

// Applicable to other countries or areas
TapCommon.OpenReviewInTapGlobal(appId, openSuccess =>
{
    if (openSuccess) {
        Debug.Log("Open the game comment section successfully");
    }
});
```

</Conditional>

<Conditional region="global">

```cs
TapCommon.OpenReviewInTapGlobal(appId, openSuccess =>
{
    if (openSuccess) {
        Debug.Log("Open the game comment section successfully");
    }
});
```

</Conditional>

</>

<>

<Conditional region="cn">

```java
//  For Mainland China
if(TapGameUtil.openReviewInTapTap(this,"appid")){
    Log.d(TAG, "Open the game comment section successfully");
}

// Applicable to other countries or areas
if(TapGameUtil.openReviewInTapGlobal(this,"appid")){
    Log.d(TAG, "Open the game comment section successfully");
}
```

</Conditional>

<Conditional region="global">

```java
if(TapGameUtil.openReviewInTapGlobal(this,"appid")){
    Log.d(TAG, "Open the game comment section successfully");
}
```

</Conditional>

</>

<>

```objc

```

</>

</MultiLang>

appid: the unique identifier of the game in the TapTap shop.
Example:<Conditional region="cn">`https://www.taptap.cn/app/187168`</Conditional><Conditional region="global">`https://www.taptap.io/app/187168`</Conditional>，where `187168` is the `appid`.


## Testing
To ensure that the game works correctly for users who use the update wake-up feature after launch, please follow the instructions below to complete the self-test.

### Upload APK

New applications must upload a test APK to the Developer Centre and pass the self-test. For games that have already been uploaded, please ensure that the APK package name in the updated version is the same as in the uploaded version.

### Launching the app

If you don't want players to download the game package via TapTap, you can set the game status to 'Reserved' or 'Stay tuned'.

### Start testing

The normal state after triggering the update recall function is to recall the app details page in the TapTap Shop.




