---
title: TapADN SDK 接入指南
---

<head>
  <meta name="robots" content="noindex" />
</head>

import MultiLang from '/src/docComponents/MultiLang';
import CodeBlock from '@theme/CodeBlock';
import sdkVersions from '/src/docComponents/sdkVersions';
import { Conditional } from "/src/docComponents/conditional";

## SDK 配置

<!--可以在 [下载页](/tap-download) 获得 TapSDK，引入广告模块。-->

<MultiLang kind="adn">

<>

Unity 模块是通过引入 Android 模块后增加桥接文件打包出的 `.unitypackage`，方便以 Unity 开发的游戏直接引入。其他引擎/平台的游戏可以通过 Android 原生的方式接入，详见 Android 接入文档。

**开发环境要求**：

- Unity 2019.4 或更高版本
- Android 5.0（API level 21）或更高版本

:::tip
Unity 项目可在 `TapTap/TapAD/Demo` 找到示例工程来了解其实现过程，注意** Demo 工程需要到真机中才能看到效果，Editor 环境并不会实际生效**。
:::

<details>

<summary>点击展开 Unity 2020.3.15 之前的版本升级 Gradle 版本</summary>

在 `Project Settings` -> `Player` -> `Android Tab` -> `Publish Settings` -> `Build`，然后勾选**Custom Base Gradle Template**

将以下更改应用于生成的这个文件:
**Assets/Plugins/Android/baseProjectTemplate.gradle**

如果存在，请移除文件顶部的以下注释：

```groovy
// GENERATED BY UNITY. REMOVE THIS COMMENT TO PREVENT OVERWRITING WHEN EXPORTING AGAIN
```

修改文件内容:

```groovy
dependencies {
    // If you are changing the Android Gradle Plugin version, make sure it is compatible with the Gradle version preinstalled with Unity
    // See which Gradle version is preinstalled with Unity here https://docs.unity3d.com/Manual/android-gradle-overview.html
    // See official Gradle and Android Gradle Plugin compatibility table here https://developer.android.com/studio/releases/gradle-plugin#updating-gradle
    // To specify a custom Gradle version in Unity, go do "Preferences > External Tools", uncheck "Gradle Installed with Unity (recommended)" and specify a path to a custom Gradle version
    // highlight-start
    // 将 3.x.0 版本修改为 4.0.1
    //classpath 'com.android.tools.build:gradle:3.x.0'
    classpath 'com.android.tools.build:gradle:4.0.1'
    // highlight-end
    **BUILD_SCRIPT_DEPS**
}
```

同时，为了将 [Gradle 版本和 Android Gradle Plugin 版本对应](https://developer.android.com/studio/releases/gradle-plugin#expandable-1)，需要更新 Gradle 版本，下载 [6.1.1 版本的 Gradle](https://services.gradle.org/distributions/gradle-6.1.1-bin.zip)，解压后放到自定义的文件夹中，同时**不**勾选 Unity 中的 `Preferences` -> `External Tools`-> `Android` -> `Gradle Installed with Unity(recommend)`，改为选择解压后 Gradle 文件夹的位置，如 <some path\>/gradle-6.1.1

</details>

无论 Unity 版本都添加一些原生依赖库：在 `Project Settings` -> `Player` -> `Android Tab` -> `Publish Settings` -> `Build`，勾选**Custom Main Gradle Template**

将以下更改应用于生成的这个文件:
**Assets/Plugins/Android/mainTemplate.gradle**

如果存在，请移除文件顶部的以下注释：

```groovy
// GENERATED BY UNITY. REMOVE THIS COMMENT TO PREVENT OVERWRITING WHEN EXPORTING AGAIN
```

修改文件内容:

```groovy
dependencies {
    implementation fileTree(dir: 'libs', include: ['*.jar'])
    // highlight-start
// 加入的依赖库-开始
    implementation 'io.reactivex.rxjava2:rxandroid:2.0.1'
    implementation 'io.reactivex.rxjava2:rxjava:2.0.1'
    implementation 'com.squareup.okhttp3:okhttp:3.12.1'
    implementation "com.android.support:appcompat-v7:28.0.0"
    implementation "com.android.support:support-annotations:28.0.0"
    implementation "com.android.support:support-v4:28.0.0"
    implementation "com.github.bumptech.glide:glide:4.0.0"
    implementation 'com.android.support:recyclerview-v7:28.0.0'
// 加入的依赖库-结束
    // highlight-end
// **DEPS**
}
```

</>

<>

最低支持 Android 5.0（API level 21），编译环境为 Android Studio。

<p>
将 <code>TapAD_{sdkVersions.tapadn.android}.aar</code> 拷贝到游戏目录下的 src/main/libs 目录中。
</p>

在游戏目录下 `build.gradle` 文件中添加代码：

<CodeBlock className="groovy">
{`repositories{
    flatDir{   
        dirs 'src/main/libs'
    }
}
dependencies {
    // ...
    implementation(name: "TapAD_${sdkVersions.taptap.ios}", ext: "aar") // 广告 SDK
    implementation 'io.reactivex.rxjava2:rxandroid:2.0.1'
    implementation 'io.reactivex.rxjava2:rxjava:2.0.1'
    implementation 'com.squareup.okhttp3:okhttp:3.12.1'
    implementation "com.android.support:appcompat-v7:28.0.0"
    implementation "com.android.support:support-annotations:28.0.0"
    implementation "com.android.support:support-v4:28.0.0"
    implementation "com.github.bumptech.glide:glide:4.0.0"
    implementation 'com.android.support:recyclerview-v7:28.0.0'
    // ...
}`}
</CodeBlock>

</>

<>

</>

</MultiLang>

### 权限申请

<MultiLang kind="adn">

<>

无论 Unity 版本都需加入 Android 相关权限申请，在 `Project Settings` -> `Player` -> `Android Tab` -> `Publish Settings` -> `Build`，勾选**`Custom Main Manifest`**。

将以下更改应用于生成的这个文件:
**Assets/Plugins/Android/AndroidManifest.xml**

如果存在，请移除文件顶部的以下注释：
``` xml
// GENERATED BY UNITY. REMOVE THIS COMMENT TO PREVENT OVERWRITING WHEN EXPORTING AGAIN
```

修改文件内容:

```xml
<?xml version="1.0" encoding="utf-8"?>
<manifest
        xmlns:android="http://schemas.android.com/apk/res/android"
        package="com.unity3d.player"
        xmlns:tools="http://schemas.android.com/tools">

    // highlight-start
    <!-- TapAd 必须的权限-开始  -->
    <!-- TargetVersion 31 及以上 通过时，需要该权限) deviceName 和下面的 BLUETOOTEH 互斥-->
    <uses-permission android:name="android.permission.BLUETOOTH_CONNECT"/>
    <!-- 广告获取坐标（经度、纬度、精度半径（米）、获取时间 毫秒）精准推送 -->
    <uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
    <uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>
    <!-- IMEI 、序列号、MEID 、IMSI 、 ICCID 等信息。TargetSdkVersion 4以及更高需要申请 -->
    <uses-permission android:name="android.permission.READ_PHONE_STATE"/>
    <!-- TapAd 必须的权限-结束  -->
    
    <!-- TapAd 可选择权限-开始   -->
    <!-- 获取网络状态信息   -->
    <uses-permission android:name="android.permission.ACCESS_WIFI_STATE"/> 
    <!-- 获取安装应用列表  Android 11及以上版本才需声明,Android 11以下版本无需申请 -->
    <uses-permission android:name="android.permission.QUERY_ALL_PACKAGES"/>
    <!-- （targetVersion 31 以下）deviceName 和上面的 BLUETOOTH_CONNECT 互斥-->
    <uses-permission android:name="android.permission.BLUETOOTH"/>
    <!-- 允许应用请求安装软件包 -->
    <uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES"/>
    <!-- TapAd 可选择权限-结束   -->
    // highlight-end
    ...
```

</>

<>

配置 AndroidManifest.xml

```xml
<!-- 广告SDK已添加的权限 -->
<uses-permission android:name="android.permission.INTERNET"/>>
<uses-permission android:name="android.permission.ACCESS_NETWORK_STATE"/>
<uses-permission android:name="android.permission.READ_PHONE_STATE"/>
<uses-permission android:name="android.permission.QUERY_ALL_PACKAGES" />
<uses-permission android:name="android.permission.REQUEST_INSTALL_PACKAGES" />

<!-- 为了获取更精准的推送数据、建议游戏加上的权限 -->
<uses-permission android:name="android.permission.BLUETOOTH"/>
<!-- targetVersion 31 及以上 建议游戏加上这个权限 -->
<uses-permission android:name="android.permission.BLUETOOTH_CONNECT"/>
<!-- 为了获取更好的广告体验，建议游戏加上以下权限来获取用户信息 -->
<uses-permission android:name="android.permission.ACCESS_FINE_LOCATION"/>
<uses-permission android:name="android.permission.ACCESS_COARSE_LOCATION"/>
<!-- 加上下列权限可以提高广告的转化率 -->
<uses-permission android:name="android.permission.POST_NOTIFICATIONS"/>
```

</>

<>

</>

</MultiLang>

## 获取广告权限

在获取 imei 地理位置时，需要用户授予权限。建议先询问权限，再进行初始化工作。

<MultiLang kind="adn">

<>

```cs
using TapTap.TapAd
TapAdSdk.RequestPermissionIfNecessary();
```

</>

<>

```java
TapAdManager.get().requestPermissionIfNecessary(activity);
```

</>

<>

</>

</MultiLang>

## 初始化

<MultiLang kind="adn">

<>

```cs
using TapTap.TapAd

TapAdConfig config = new TapAdConfig.Builder()
                .MediaId(your_media_id)             // 必选参数。为 TapADN 注册的媒体 ID
                .MediaName(your_media_name)         // 必选参数。为 TapADN 注册的媒体名称
                .MediaKey(your_media_key)           // 必选参数。媒体密钥，可以在 TapADN 后台查看（用于传输数据的解密）
                .MediaVersion("1")                  // 必选参数。默认值 "1"
                .Channel(your__channel)             // 必选参数，渠道
                .TapClientId(your_tap_client_id)    // 可选参数。TapTap 开发者中心的游戏 Client ID 
                .EnableDebugLog(false)              // 可选参数，是否打开原生 debug 调试信息输出：true 打开、false 关闭。默认 false 关闭
                .Build();

// CustomControllerWrapper 为实现了 TapTap.TapAd.ICustomController 的类
// onInitedCallback 为可选回调函数，类型是 System.Action，
TapAdSdk.Init(config, new CustomControllerWrapper(this), onInitedCallback);

// ICustomController 接口说明
public interface ICustomController
{
    // 是否允许 SDK 主动使用地理位置信息
    bool CanUseLocation { get; }

    // 当 isCanUseLocation=false 时，可传入地理位置信息，TapAd 使用您传入的地理位置信息
    TapAdLocation GetTapAdLocation { get; }

    // 是否允许 SDK 主动使用手机硬件参数，如 imei
    bool CanUsePhoneState { get; }

    // 当 isCanUsePhoneState=false 时，可传入 imei 信息，TapAd 使用您传入的 imei 信息
    string GetDevImei { get; }

    // 是否允许 SDK 主动使用 ACCESS_WIFI_STATE 权限
    bool CanUseWifiState { get; }

    // 是否允许 SDK 主动使用 WRITE_EXTERNAL_STORAGE 权限
    bool CanUseWriteExternal { get; }

    // 开发者可以传入 oaid
    // 信通院 OAID 的相关采集——如何获取 OAID：
    // 1. 移动安全联盟官网 http://www.msa-alliance.cn/
    // 2. 信通院统一 SDK 下载 http://msa-alliance.cn/col.jsp?id=120
    string GetDevOaid { get; }

    // 是否允许 SDK 主动获取设备上应用安装列表的采集权限
    bool Alist { get; }

    // 是否允许 SDK 主动获取 ANDROID_ID
    bool CanUseAndroidId { get; }

    // 用户信息（为了提高广告的推送效率，开发者可以帮助传入一些用户的画像信息）
    CustomUser ProvideCustomer();
}

// 地理位置说明
public sealed class TapAdLocation 
{
    // 纬度
    public double latitude;

    // 经度
    public double longitude;

    // 精度
    public double accuracy;
    
    // 设置经纬度
    public TapAdLocation(double latitude, double longitude, double accuracy)
    {
        //...
    }
}

// 用户信息
public sealed class CustomUser
{
    public int realAge;
    // 0.男;1.女
    public int realSex;
    // 角色性别 0.男;1.女
    public int avatarSex;
    // 角色等级
    public int avatarLevel;
    // 是否新玩家 0.否;1.是
    public int newUserStatus;
    // 是否为付费用户 0.否;1.是
    public int payedUserStatus;
    // 是否通过新手教程 0.否;1.是
    public int beginMissionFinished;
    // 角色当前付费道具数量
    public int avatarPayedToolCnt;
}
```

</>

<>

```java
TapAdConfig config = new TapAdConfig.Builder()
                .withMediaId(your_media_id)              // 必选参数。为 TapADN 注册的媒体 ID
                .withMediaName(your_media_name)          // 必选参数。为 TapADN 注册的媒体名称
                .withMediaKey(your_media_key)            // 必选参数。媒体密钥，可以在TapADN后台查看
                .withMediaVersion("1")                   // 必选参数。默认值 "1"
                .withTapClientId(your_tap_client_id)     // 可选参数。TapTap 开发者中心的游戏 Client ID           
                .enableDebug(true)                       // 可选参数，是否打开 debug 调试信息输出：true 打开、false 关闭。默认 false 关闭
                .withGameChannel(your_app_channel)       // 必选参数，渠道
                .withCustomController(new TapAdCustomController() {

                    // 是否允许 SDK 主动使用地理位置信息
                    @Override
                    public boolean isCanUseLocation() {
                        return enableGetLocation;
                    }

                    // 当 isCanUseLocation=false 时，可传入地理位置信息，TapAd 使用您传入的地理位置信息
                    @Override
                    public TapAdLocation getTapAdLocation() {
                        return new TapAdLocation(longitude, latitude, accuracy);
                    }

                    // 是否允许 SDK 主动使用手机硬件参数，如 imei
                    @Override
                    public boolean isCanUsePhoneState() {
                        return enableGetPhoneState;
                    }

                    // 当 isCanUsePhoneState=false 时，可传入 imei 信息，TapAd 使用您传入的 imei 信息
                    @Override
                    public String getDevImei() {
                        return imei;
                    }

                    // 是否允许 SDK 主动使用 ACCESS_WIFI_STATE 权限
                    @Override
                    public boolean isCanUseWifiState() {
                        return enableGetWifiState;
                    }

                    // 是否允许 SDK 主动使用 WRITE_EXTERNAL_STORAGE 权限
                    @Override
                    public boolean isCanUseWriteExternal() {
                        return enableWriteExternal;
                    }

                    // 开发者可以传入 oaid
                    // 信通院 OAID 的相关采集——如何获取 OAID：
                    // 1. 移动安全联盟官网 http://www.msa-alliance.cn/
                    // 2. 信通院统一 SDK 下载 http://msa-alliance.cn/col.jsp?id=120
                    @Override
                    public String getDevOaid() {
                        return oaid;
                    }

                    // 是否允许 SDK 主动获取设备上应用安装列表的采集权限
                    @Override
                    public boolean alist() {
                        return enableGetAppList;
                    }

                    // 是否允许 SDK 主动获取 ANDROID_ID
                    @Override
                    public boolean isCanUseAndroidId() {
                        return enableGetAndroidId;
                    }

                    @Override
                    public CustomUser provideCustomUser() {
                        return new CustomUser.Builder()
                                .withRealAge(age)                   // 年龄
                                .withRealSex(sex)                   // 性别 0:男 1：女
                                .withAvatarSex(avatarSex)           // 角色性别 0:男 1：女
                                .withAvatarLevel(avatarLevel)       // 角色等级
                                .withNewUserStatus(status)          // 是否新玩家 0:否；1:是
                                .withPayedUserStatus(status)        // 是否付费用户 0:否；1:是
                                .withBeginMissionFinished(finished) // 是否通过新手教程 0:否 1:是
                                .withAvatarPayedToolCnt(cnt)        // 角色当前付费道具数量
                                .build();
                    }
                })
                .build();

TapAdSdk.init(this, config);
```

</>

<>

</>

</MultiLang>

## 上报用户行为

为了获取更优质的广告内容，需要游戏额外提供一些玩家在游戏中的行为数据作为补充。

<MultiLang kind="adn">

<>

```cs
using TapTap.TapAd
var userActions = new UserAction[3];
var jan1st1970 = new DateTime
    (1970, 1, 1, 0, 0, 0, DateTimeKind.Utc);
for (int i = 0 ; i < 3; i ++) {
    var tmp = new UserAction(actionType: i, actionTime: (long)(DateTime.UtcNow - jan1st1970).TotalMilliseconds,
                amount: i * 1000, winStatus: i % 2);
    userActions[i] = tmp;
}
// highlight-start
// CustomUserAction 为实现了 IUserAction 的类
// highlight-end
TapAdSdk.UploadUserAction(userActions, new CustomUserAction(this));
// 用户行为数据类说明
public class UserAction
{
    // 行为动作类型,可自定义
    public int ActionType { get; }

    // 行为发生时间（单位：秒）
    public long ActionTime { get; }

    // 付费金额
    public int Amount{ get; }

    // 是否胜利.0-失败;1-胜利
    public int WinStatus{ get; }
    public UserAction(int actionType, long actionTime, int amount, int winStatus) 
    {
        ...
    }
}
// 上报接口说明
public interface IUserAction
{
    // 上报成功
    void OnSuccess();

    // 上报失败
    void OnError(int code, string message);
}
```

</>

<>

```java
UserAction[] userActions = new UserAction[3];

for (int i = 0 ; i < 3; i ++) {
    UserAction tmp = new UserAction.Builder()
            .withActionType(i)
            .withActionTime(System.currentTimeMillis())
            .withAmount(i * 1000)
            .withWinStatus(i % 2)
            .build();
    userActions[i] = tmp;
}
TapAdManager.get().uploadUserAction(userActions, new Callback() {
    @Override
    public void onSuccess() {
        // 上报成功
    }

    @Override
    public void onError(AdException exception) {
        // 上报失败
    }
});
```

</>

<>

</>

</MultiLang>

## 开屏广告 {#TapSplashAd}

开屏广告为用户在进入 App 时展示的全屏广告。开屏广告为一个 `View`，宽高默认为 `match_parent`。

:::info
竖屏开屏广告 `view` 要求 width = 屏幕宽，height 需要 >= 75% 屏幕高，否则会影响计费。

横屏开屏广告 `view` 要求 width = 屏幕宽，height 需要 = 屏幕高，否则会影响计费。
:::

建议业务逻辑：

1. 每次启动应用的时候调用 SDK 接口请求开屏广告。
2. SDK 会根据一定规则从候选队列里选取一个返回给游戏，获取成功就可以展示，获取失败的话本次不展示广告。

### 获取广告

<MultiLang kind="adn">

<>

```cs
using TapTap.TapAd
TapSplashAd _tapSplashAd = null;
if (TapAdSdk.IsInited == false)
{
    Debug.Log("TapAd 需要先初始化!");
    return;
}
// 释放之前的广告
if (_tapSplashAd != null)
{
    _tapSplashAd.Dispose();
    _tapSplashAd = null;
}
int adId = YOUR_AD_ID;
// create AdRequest
var request = new TapAdRequest.Builder()
    .SpaceId(adId)
    .Build();
_tapSplashAd = new TapSplashAd(request);
// highlight-start
// SplashAdLoadListener 为实现了 ISplashAdLoadListener 的类
// highlight-end
_tapSplashAd.SetLoadListener(new SplashAdLoadListener(this));
_tapSplashAd.Load();
// Splash 加载接口说明
public interface ISplashAdLoadListener : ICommonLoadListener
{
    // 当 Splash 加载完毕
    void OnSplashAdLoad(TapSplashAd ad);
}
// 通用加载接口说明
public interface ICommonLoadListener
{
    // 加载出错回调
    void OnError(int code, string message);
}
```

</>

<>

```java
TapAdNative tapAdNative = TapAdManager.get().createAdNative(activity);
// 广告后台获取广告位id
int spaceId = "your_space_id";
tapAdNative.loadSplashAd(new AdRequest.Builder().withSpaceId(spaceId).build(), new TapAdNative.SplashAdListener() {

    @Override
    public void onError(int code, String message) {
        // 获取失败
    }

    @Override
    public void onSplashAdLoad(TapSplashAd splashAd) {
        // 获取成功，可以在这时候播放广告

    }
});
```

</>

<>

</>

</MultiLang>

### 播放

<MultiLang kind="adn">

<>

```cs
using TapTap.TapAd
if (TapAdSdk.IsInited == false)
{
    Debug.Log("TapAd 需要先初始化!");
    return;
}
if (_tapSplashAd != null)
{
    // highlight-start
    // SplashInteractionListener 为实现了 ISplashAdInteractionListener 的类
    // highlight-end
    _tapSplashAd.SetInteractionListener(new SplashInteractionListener(this));
    _tapSplashAd.Show();
}
else
{
    Debug.LogErrorFormat($"[Unity::AD] 未加载好视频,无法播放!");
}
// Splash 播放回调接口说明
public interface ISplashAdInteractionListener : ICommonInteractionListener
{
    // 点击跳过
    void OnAdSkip(TapSplashAd ad);

    // 广告时间到
    void OnAdTimeOver(TapSplashAd ad);
}
// 通用播放回调接口说明
public interface ICommonInteractionListener
{
    
}
```

</>

<>

```java
// 注册开屏广告交互事件监听
splashAd.setSplashInteractionListener(new TapSplashAd.AdInteractionListener() {
    @Override
    public void onAdSkip() {
        // 点击了跳过，可以进入游戏
    }

    @Override
    public void onAdTimeOver() {
        // 开屏时间到（开屏页已关闭），可以进入游戏
    }
});
// 展示开屏页
splashAd.show(this);
```

</>

<>

</>

</MultiLang>

## 激励视频广告 {#TapRewardVideoAd}

激励视频是一种全屏播放的视频广告，用户可以在观看完整的视频后获取奖励,视频广告播放结束后会显示结束页面，引导用户进行后续动作。目前激励视频广告的表现形式为：视频播放完展示 Endcard 页面。

使用场景包括但不限于：

1. 游戏等应用内观看视频广告获得游戏内金币等。
2. 积分类应用接入。

:::info 支持的广告尺寸
- 全屏横屏（宽高比 16:9）
- 全屏竖屏（宽高比 9:16）
- Android 端暂不支持重力旋转。
:::

### 获取广告

<MultiLang kind="adn">

<>

```cs
using TapTap.TapAd
TapRewardVideoAd _tapRewardAd = null;
if (TapAdSdk.IsInited == false)
{
    Debug.Log("TapAd 需要先初始化!");
    return;
}
if (_tapRewardAd != null)
{
    _tapRewardAd.Dispose();
    _tapRewardAd = null;
}
int adId = YOUR_AD_ID;
// create AdRequest
var request = new TapAdRequest.Builder()
    .SpaceId(adId)
    .RewardName("your_reward_name")
    .RewardCount(your_reward_count)
    .Build();
_tapRewardAd = new TapRewardVideoAd(request);
// highlight-start
// RewardVideoAdLoadListener 为实现了 IRewardVideoAdLoadListener 的类
// highlight-end
_tapRewardAd.SetLoadListener(new RewardVideoAdLoadListener(this));
_tapRewardAd.Load();
// 激励视频广告加载回调接口说明
public interface IRewardVideoAdLoadListener : ICommonLoadListener
{
    // 当激励视频被 Cache 完毕
    void OnRewardVideoAdCached(TapRewardVideoAd ad);

    // 当激励视频被 Load 完毕
    void OnRewardVideoAdLoad(TapRewardVideoAd ad);
}
// 通用广告加载回调接口说明
public interface ICommonLoadListener
{
    // 加载出错回调
    void OnError(int code, string message);
}
```

</>

<>

```java
// 注意，一个 Activity 中只需要创建一个 TapAdNative 对象
TapAdNative tapAdNative = TapAdManager.get().createAdNative(activity);

AdRequest adRequest = new AdRequest.Builder()
                            .withSpaceId("your_space_id")         // 广告后台获取广告位id
                            .withRewordName("your_reward_name")   // 奖品名称
                            .rewardAmount("your_reward_amount")   // 奖品数量
                            .withExtra1("your_extra_info")。      // 游戏如果要通过 s2s 验证激励广告有效性的时候需要传入一些辅助信息来验证本次激励活动是否有效
                            .withUserId("game_user_id")           // 游戏如果要通过 s2s 验证激励广告有效性的时候需要传入游戏中的玩家id，来验证是否可以对当前用户发放奖励
                            .build();

tapAdNative.loadRewardVideoAd(adRequest, new TapAdNative.RewardVideoAdListener() {
    @Override
    public void onError(int code, String message) {
        // 获取失败
    }

    @Override
    public void onRewardVideoAdLoad(TapRewardVideoAd rewardVideoAd) {
        // 获取广告成功，可以展示广告
    }

    @Override
    public void onRewardVideoCached(TapRewardVideoAd rewardVideoAd) {
        // 获取广告素材成功，可以展示广告，如果没有选择在 RewardVideoAdLoad 时展示广告。（更建议在这个回调中展示广告，体验更好）
    }
});
```

</>

<>

</>

</MultiLang>

### 播放

<MultiLang kind="adn">

<>

```cs
using TapTap.TapAd
if (TapAdSdk.IsInited == false)
{
    Debug.Log("TapAd 需要先初始化!");
    return;
}
if (_tapRewardAd != null)
{
    // highlight-start
    // RewardVideoInteractionListener 为实现了 IRewardVideoInteractionListener 的类
    // highlight-end
    _tapRewardAd.SetInteractionListener(new RewardVideoInteractionListener(this));
    _tapRewardAd.Show();
}
else
{
    Debug.LogErrorFormat($"[Unity::AD] 未加载好视频,无法播放!");
}
// 激励视频广告播放回调接口说明
public interface IRewardVideoInteractionListener : ICommonInteractionListener
{
    // 当广告出现
    void OnAdShow(TapRewardVideoAd ad);
    
    // 当广告关闭
    void OnAdClose(TapRewardVideoAd ad);

    // 当视频完成
    void OnVideoComplete(TapRewardVideoAd ad);

    // 视频出错
    void OnVideoError(TapRewardVideoAd ad);

    // 视频播放完毕，奖励确认可以发放
    void OnRewardVerify(TapRewardVideoAd ad, bool rewardVerify, int rewardAmount, string rewardName, int code, string msg);

    // 当跳过视频
    void OnSkippedVideo(TapRewardVideoAd ad);
}
// 通用广告播放回调接口说明
public interface ICommonInteractionListener
{
    
}
```

</>

<>

```java
// 注册激励广告交互事件监听
rewardAd.setRewardAdInteractionListener(new TapRewardVideoAd.RewardAdInteractionListener() {
    @Override
    public void onAdShow() {
        // 激励广告已显示
    }

    @Override
    public void onAdClose() {
        // 激励广告已经关闭
    }

    @Override
    public void onVideoComplete() {
        // 视频播放结束
    }

    @Override
    public void onVideoError() {
        // 视频出错
    }

    @Override
    public void onRewardVerify(boolean rewardVerify, int rewardAmount, String rewardName, int code, String msg) {
        // 激励任务已完成，游戏可以选择在此时进行玩家奖励，或者进一步通过 s2s 的流程来确认是否可以对当前玩家发放奖励
    }

    @Override
    public void onSkippedVideo() {
        // 激励广告中玩家点击了跳过视频的按钮
    }
});
rewardAd.showRewardVideoAd(activity);
```

</>

<>

</>

</MultiLang>

## Banner 广告 {#TapBannerAd}

模版渲染 Banner：开发者不用自行对广告样式进行编辑和渲染，可直接调用相关接口进行广告展示。

:::tip
不支持开发者在 view 添加按钮及对广告拦截处理
:::

### 获取广告

<MultiLang kind="adn">

<>

```cs
using TapTap.TapAd

TapBannerAd _tapBannerAd = null;
if (TapAdSdk.IsInited == false)
{
    Debug.Log("TapAd 需要先初始化!");
    return;
}
if (_tapBannerAd != null)
{
    _tapBannerAd.Dispose();
    _tapBannerAd = null;
}
int adId = YOUR_AD_ID;
// create AdRequest
var request = new TapAdRequest.Builder()
    .SpaceId(adId)
    .Build();
_tapBannerAd = new TapBannerAd(request);
// highlight-start
// BannerAdLoadListener 为实现了 IBannerAdLoadListener 的类
// highlight-end
_tapBannerAd.SetLoadListener(new BannerAdLoadListener(this));
_tapBannerAd.Load();
// banner 广告加载回调接口说明
public interface IBannerAdLoadListener : ICommonLoadListener
{
    // 当 Banner 加载完毕
    void OnBannerAdLoad(TapBannerAd ad);
}
// 通用广告加载回调接口说明
public interface ICommonLoadListener
{
    // 加载出错回调
    void OnError(int code, string message);
}
```

</>

<>

```java
// 注意，一个 Activity 中只需要创建一个 TapAdNative 对象
TapAdNative tapAdNative = TapAdManager.get().createAdNative(activity);
// 广告后台获取广告位 id
int spaceId = "your_space_id";
tapAdNative.loadBannerAd(new AdRequest.Builder().withSpaceId(spaceId).build(), new TapAdNative.BannerAdListener() {
    @Override
    public void onError(int code, String message) {
        // 获取广告失败
    }

    @Override
    public void onBannerAdLoad(TapBannerAd bannerAd) {
        // 获取广告成功，可以调用播放广告接口进行播放（**注意** banner 广告的获取和播放需要在同一个 activity 中）
    }
});
```

</>

<>

</>

</MultiLang>

### 播放

<MultiLang kind="adn">

<>

```cs
using TapTap.TapAd
if (TapAdSdk.IsInited == false)
{
    Debug.Log("TapAd 需要先初始化!");
    return;
}
// highlight-start
// BannerInteractionListener 为实现了 IBannerAdInteractionListener 的类
// highlight-end
if (_tapBannerAd != null)
{
    _tapBannerAd.SetInteractionListener(new BannerInteractionListener(this));
    _tapBannerAd.Show();
}
else
{
    Debug.LogErrorFormat($"[Unity::AD] 未加载好视频,无法播放!");
}
// banner 广告播放回调接口说明
public interface IBannerAdInteractionListener : ICommonInteractionListener
{
    // 当广告关闭
    void OnAdClose(TapBannerAd ad);

    // 当点击广告
    void OnAdClick(TapBannerAd ad);

    // 当点击下载
    void OnDownloadClick(TapBannerAd ad);
}
// 通用广告播放回调接口说明
public interface ICommonInteractionListener
{
    
}
```

</>

<>

```java
bannerAd.setBannerInteractionListener(new TapBannerAd.BannerInteractionListener() {
    @Override
    public void onAdClose() {
        // 广告已关闭（玩家可以手动点击关闭 banner 广告）
    }

    @Override
    public void onAdClick() {
        // 玩家点击了 banner 广告
    }

    @Override
    public void onDownloadClick() {
        // 玩家点击了下载按钮
    }
});

FrameLayout parentLayout = "your_layout";
parentLayout.addView(bannerAd.getBannerView());
```

</>

<>

</>

</MultiLang>

## Android 代码混淆

为了保证 SDK 在代码混淆后能正常运作，需要加入防混淆配置，可以参考下列配置：

```
-dontwarn com.tapadn.**
-keep class com.tapadn.** { *;}
-dontshrink
```
