---
title: 常见问题
sidebar_label: 常见问题
sidebar_position: 3
---

import MultiLang from '/src/docComponents/MultiLang';

## 常见问题

<Conditional region="cn">

### 个人/团体的开发者需要接入防沉迷吗

按照国家新闻出版署[《关于进一步严格管理切实防止未成年人沉迷网络游戏的通知》](https://www.nppa.gov.cn/xxfb/tzgs/202108/t20210830_666285.html)，各游戏出版运营企业均须在游戏内落实游戏实名认证和防沉迷新策略。
对于没有版号的游戏，可以接入 TDS 推出的[实名认证防沉迷](/sdk/anti-addiction/features/)。

### 防沉迷和登录有什么关系？

自 3.7.1 版本开始，快速认证不依赖 TapTap 登录 SDK，故防沉迷和登录**没有**强关联关系。但是使用了 TapTap 登录后，可以使用防沉迷的[快速认证](/sdk/anti-addiction/features/#taptap-快速认证)，在经过玩家同意授权之后，允许玩家使用在 TapTap 里已经通过国家认证的实名信息快速完成游戏中的认证流程。
除此之外，还可以使用直接使用我们提供的[实名认证](/sdk/anti-addiction/features/#游戏实名认证与防沉迷)功能。TDS 已为开发者自动对接了中宣部网络游戏防沉迷实名认证系统，并以开发者主体进行信息上报，符合中宣部对游戏企业接入的合规要求。


### 实名认证通过后退出账号，再次启动游戏，会跳过实名认证流程

自 3.7.1 版本开始，快速认证不依赖 TapTap 登录 SDK，故防沉迷和登录**没有**强关联关系。玩家首次进入游戏会触发实名认证弹窗，让玩家授权游戏获取 TapTap 实名信息或输入身份信息，认证通过后，后面每一次以同样的 `userIdentifier` （唯一标识）调用认证接口都会直接拿到第一次认证的结果，不再触发弹窗。如玩家需要换用其他账号登录，需要主动退出账号。

</Conditional>

### 如何开通实名认证与防沉迷服务

可以在 **开发者中心后台 > 游戏服务 > 开发与构建 > 合规认证** 处自助开通服务。目前提供两种方案，游戏开通时选择其中一种：

* **有版号**。完成控制台提示的前置条件，点击开通，然后配置好[中宣部参数](/sdk/anti-addiction/features/#注册中宣部实名认证系统)：
    * 将中宣部系统后台的**游戏备案识别码、应用标识、应用密钥**填写到 TapTap 开发者中心后台对应处。
    * 将 TapTap 开发者中心后台显示的 **IP 白名单地址**复制、填写到中宣部系统后台。
* **暂无版号**。无版号游戏无法配置中宣部参数，可直接选择开通，等游戏有了版号，可以配置[中宣部参数](/sdk/anti-addiction/features/#注册中宣部实名认证系统)并切换到有版号方案。切换后客户端代码不受影响，不需要修改。

### SDK 自带哪些用户界面（UI）

实名认证和防沉迷 SDK 提供的用户界面主要在防沉迷授权阶段，可参考[功能介绍文档](/sdk/anti-addiction/features/#接入-tds-实名认证和防沉迷服务)中的界面预览。

### 授权失败

在实名认证时使用 TapTap 快速认证服务提示「授权失败」，请至后台[配置签名证书](/sdk/start/quickstart/#配置签名证书)。

### 未查询到实名认证配置 

实名认证时使用手动输入实名信息服务提示「未查询到实名认证配置」，原因是未开启实名认证服务，需要在 开发者中心后台 > 游戏服务 > 开发与构建 > 合规认证 处自助开通服务。

### userIdentifier is empty

调用认证接口时需要传入的玩家唯一标识 userIdentifier 参数值为空，建议开发者对此做非空判断。

### 未弹出实名认证窗口/未收到回调

这种情况一般是仅调用了初始化防沉迷 UI 模块代码，也就是说只完成了 SDK 的初始化，同时注册防沉迷的消息监听。

触发实名认证弹窗**必须调用** [认证接口](/sdk/anti-addiction/guide/#防沉迷认证)，之后才会收到回调。

### 重复认证

我们预期同一个玩家认证过一次之后不再触发弹窗，防沉迷服务直接使用第一次认证的结果，这样用户体验更好。

如果出现重复认证，可以按照以下思路排查：

* 首先确认游戏使用的 [玩家唯一标识 userIdentifier](#玩家唯一标识-useridentifier-参数说明) 符合要求。如果同一个玩家用的 userIdentifier 会发生改变，在防沉迷服务中会被视为不同用户，导致重复认证。这个时候需要游戏传入合适的 userIdentifier，建议接入 [TDS 内建账户系统](/sdk/taptap-login/guide/start/#一键完成-taptap-登录)，用 `objectId` 作为玩家唯一标识；或者使用[单纯 TapTap 用户认证](/sdk/taptap-login/guide/tap-login/#taptap-登录并获取登录结果)，传入 `openid` 或 `unionid` 作为玩家唯一标识。
* 如果是**有版号游戏**，请确认在 开发者中心后台游戏服务 > 开发与构建 > 合规认证 处填写的参数无误。如果参数有问题，请求中宣部接口会失败，导致重复认证。除此之外，还需要确定应用在中宣部是否审核通过、接口测试是否完成。请按照如下步骤进行排查：
	* **IP 白名单地址**全部填入中宣部系统后台。
	* **游戏备案识别码、应用标识**和中宣部后台保持一致。
	* **应用密钥**在有效期内（有效期为半年，注意在失效前更新）。
	* **中宣部接口测试**是否完成，完成的状态应该为**已通过**，中宣部目前需要测试的接口用例为 8 个。
	* 检查游戏在中宣部是否处于审核通过状态。
### iOS 使用快速认证完成后，实名弹窗未自动关闭

可以参考[配置跳转 TapTap 应用](/sdk/taptap-login/guide/start/#配置跳转-taptap-应用)文档，在 info.plist 中添加配置；

## 注意事项

### 玩家唯一标识 userIdentifier 参数说明

第一次认证会触发实名认证弹窗，让玩家授权游戏获取 TapTap 实名信息或输入身份信息，认证通过后，后面每一次以同样的 userIdentifier 调用认证接口都会直接拿到第一次认证的结果，不再触发弹窗。

因此，同一个用户的唯一标识应该要保证唯一性。

### 测试实名认证环境

无论是 Android 还是 iOS 项目，不支持在 Unity Editor 环境里调试，请对应打包到真实设备或者移动端的模拟器中进行测试实名认证防沉迷的相关功能。


### 在测试实名认证环境下测试帐号还需要实名

请保证在 `startup` 传入的 **玩家唯一标识** `userIdentifier` 为 TapTap 用户的 `unionid`，获取方式可以参考[获取用户信息](/sdk/taptap-login/guide/start/#获取用户信息)的内容。
