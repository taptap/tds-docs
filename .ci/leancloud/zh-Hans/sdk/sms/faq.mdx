
## 短信常见问题

### 短信有什么限制吗？

短信的发送受到双重限制：

1. 每个应用，10 秒内只能向同一个手机号码发送 1 条短信。超出后，云端将返回 [1](error_code.html#_1) 错误码，以及如下错误信息：`SMS request too fast(1 request per 10s).`

2. 同一短信签名，在一定时间段内向同一手机号码发送的短信条数受限，具体限制见下。超出后，云端将返回 [601](error_code.html#_601) 错误码直至限制解除。

    * 所有类型的短信（验证类，通知类，营销类），同一短信签名，1 分钟只能向同一个手机号码发送 1 条短信，此限制也适用于语音验证码。
    * 验证类短信，同一短信签名，同一手机号码 24 小时内最多发 10 条短信。例如 1 月 1 日上午 10:20 发送了第一条验证类短信，那么在 1 月 2 日上午 10:20 之前，最多可以再使用这个签名向同一手机号码发送 9 条验证类短信，以此类推。
    * 通知类短信，同一短信签名，同一手机号码 24 小时内最多发 15 条短信。

**通知类**短信内容如果涉及以下不正当用途，我们将停止你的短信使用权限：

* 推广营销用途
* 包含不明下载地址
* 色情、政治等法律禁止情况

以上限制对测试手机号码也同样有效。

### 语音验证码有什么限制吗？

语音验证码的限制与上述普通短信验证码发送限制不同。语音验证码的发送限制如下：

* 同一个手机号码，30 秒内最多发送 1 次
* 同一个手机号码，1 小时内最多发送 3 次
* 同一个手机号码，24 小时内最多发送 5次

### 短信的限制是否区分应用？

如上所述，短信发送受到双重限制。
10 秒内只能向同一个手机号码发送 1 条短信的限制是在应用层面的。
其他限制则在短信签名层面。

### 短信是否有免费额度，免费额度针对每个账户还是每个应用？

每个 LeanCloud 账户拥有 5 元免费的短信测试额度，**不是每个应用**；额度消耗完毕就需要付费，你可以通过充值菜单来购买短信。

### 短信的到达率如何？

我们通过接入多个短信提供商来提升普通短信的到达率。从我们实际使用来看，整体的到达率在 97%~98% 之间。为了保证重要操作的验证信息可以 100% 送达，我们也提供语音验证码服务，即短信内容通过语音电话直接发送。因此，除了普通的文本短信之外，还可以使用语音短信或者其他备份手段来向确保将通知送达用户。

### 语音验证码推荐的使用场景是什么？

推荐优先选择短信验证码，短信验证码的到达率与成功率更高。语音验证码建议和短信验证码配合使用。当发送短信验证码，用户长时间未收到短信需要重发验证码时，再通过语音验证码完成验证。

web/手机版注册页需要使用添加图形验证码，避免接口被恶意攻击。

### 怎么知道单条短信发送成功与否？

开发者可以通过 **控制台 > 短信 > 发送记录** 清楚地看到所发出的每一条短信的发送状态：

状态 | 是否计费 | 说明
---|:---:|---
发送成功 | 是 | 收到了目标手机发回来的短信接收回执，消息已经确认无误送达。
验证成功 | 是 | 对于使用我们提供的验证码短信，表示已经验证成功。
等待回执 | 是 | 运营商服务器尚未收到目标手机的接收回执，发送结果可能成功也可能失败，尚不确定。高峰时段很可能会出现延迟。
投递失败 | 是 | 电信服务商发送到手机失败。
调用失败 | **否** | 调用电信服务商接口失败。

### 有些手机收不到短信是什么情况？

首先请检查 **控制台 > 短信 > 发送记录** 有无发送数据。如果没有，请检查 API 的报错，根据报错修改客户端代码或逻辑；如果有数据，依然收不到短信，则可能有如下原因：

用户之前退订或投诉过运营商当前分发的短信通道，该号码处在运营商黑名单中，或是用户手机号不存在或关机等情况会引发「投递失败」。状态为「发送成功」而没收到短信的手机可能出现了其他问题，例如安装了某些安全软件，导致劫持或过滤了部分短信等等。

短信发送受客观因素或政策原因影响较多，没有一个通道可以保证 100% 送达。LeanCloud 短信服务通过对接多条通道、动态智能匹配最优线路，能够保证 97% 以上的到达率。

解决方案：
* 请在产品交互上，对验证码请求加上时间间隔限制，一分钟之内不允许多次请求；
* 请注意一天内不要往同一号码发送超过 5 条验证码短信（包含语音验证码）；
* 对于实在无法送达的少量手机号码，请转用语音验证码，将短信内容通过语音电话直接发送。强烈建议大家在产品上，对于同一用户尝试再次获取验证码的情况，换用语音验证码来保证绝对送达（语音验证码收费与文本短信一样）。

如果需要详查原因，请将 appId 及手机号发送到 <leancloud-support@xd.com>，我们联系运营商查询详情。商用版用户可以 [提交工单](https://leanticket.cn/t/leancloud) 咨询。

### 短信模板审核的原则有哪些？

1. 模板用途明确：通知类短信，比如活动通知、消息通知等。或者验证类短信，要求有验证码。
2. 短信用途不得违反国家法律法规，下列短信是严格禁止的：房产类、中奖类、违法类（谣言、诈骗等）、赌博类等。
3. [模板语法正确](sms-guide.html#模板变量)：我们仅支持 handlebars 语法，变量是以三个大括号括起来，类似 <code ng-non-bindable>{{{var}}}</code>。
4. 默认短信签名是应用名，你也可以在模板里设置短信签名，签名的要求请参考 [短信签名说明](sms-guide.html#短信签名)。

如果你创建的短信模板被拒绝，请注意查收邮件，查看里面的拒绝原因等。如果还有疑问，请及时与我们联系。

### 短信支持港澳台和国外吗？

支持，请参考 [短信服务覆盖的国家和地区](sms-guide.html#短信服务覆盖的国家和地区)。

### 账户余额不足有预警通知吗？

有。请在 **控制台 > 财务 > 告警** 中设置额度，告警信息将通过邮件和短信的方式发送。

### 手机号被列入了黑名单怎么办？为什么会被列入黑名单？

如果在控制台短信发送记录中查看到「投递失败」且失败原因是「运营商黑名单」，你可以提交工单或发邮件到 <leancloud-support@xd.com> 来申请解除黑名单，我们将联系运营商来解决这一问题。

被列入黑名单的可能原因有：
* 手机号的机主之前投诉过运营商，如打过 10086、10010 或 10000 投诉的，可能会被运营商加入黑名单；
* 手机号有过退订历史，如回复过含有 T、TD、退订或取消等代表拒绝接收短信的指令。

### 一条短信里最多能编辑多少个字，超过字数如何收费？

一条短信是 70 个字，中英文标点都算一个字。小于或等于 70 个字，按一条计费。

超过 70 个字符则按照 67 个字符来计算条数，最长可发 400 字。一条短信（在手机上显示的）最长可以发 400 字。

最长的 400 字的短信收费计算公式为：400/67 = 5.9， 也就是要扣 6 条短信费用。
